{% extends 'base.html' %}
<!DOCTYPE html>
<html lang="en">
<head>
    {% block head %}
    {{super()}}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    {% endblock %}
</head>
<body>
    {% block body %}
    {{super()}}
    <header style="grid-area: header;">
      <a href="/"><img src="{{url_for('static', filename='img/logo.png')}}" width="200px" style="margin-left: 20px;"></a>
    </header>
    <main style="grid-area: main;">
      <div class="dashboard">
        <div class="block-header" style="grid-area: head"><span class="h">{{comp["shortName"]}}</span><span class="d">Обновлено {{lastUpdate}}</span></div>
        <div style="grid-area: back; margin-bottom:30px;"><a class="anim" href="/">На главную</a></div>
        <div class="block" style="grid-area: general;">
          <p class="header">Основная информация:</p>
          <span><b>Сокращенное наименование</b>: {{comp["shortName"]}}</span>
          {% if comp["isAccredicted"] %}
          <span title="Аккредитация подтверждена">
            <b>ИНН</b>: {{comp["TID"]}}
            <img class="success" src="{{url_for('static', filename='img/success.png')}}">
          </span>
          {% else %}
          <span title="Нет данных об аккредитации">
            <b>ИНН</b>: {{comp["TID"]}}
            <img class="success" src="{{url_for('static', filename='img/failure.png')}}">
          </span>
          {% endif %}

          {% if comp["isActive"] %}
          <span title="Действует"><b>Статус</b>: Действует
            <img class="success" src="{{url_for('static', filename='img/success.png')}}">
          </span>
          {% else %}
          <span title="Ликвидирована/в процессе ликвидации"><b>Статус</b>: Ликвидирована или в процессе ликвидации
            <img class="success" src="{{url_for('static', filename='img/failure.png')}}">
          </span>
          {% endif %}

          <span><b>ОГРН</b>: {{comp["OGRN"]}}</span>
          <span><b>Основной вид деятельности</b>: {{comp["mainActivity"]}}</span>
        </div> 
        <div class="block" style="grid-area: tax;">
          <p class="header">Финансовая информация:</p>
          <span><b>Выручка</b>: {{comp["earnings"]}}{% if comp["earnings"] != "Нет данных" %}₽{% endif %}</span>
          <span><b>Расходы</b>: {{comp["expenses"]}}{% if comp["expenses"] != "Нет данных" %}₽{% endif %}</span>
          <span><b>Сумма уплаченных налогов</b>: {{comp["taxPayed"]}}{% if comp["taxPayed"] != "Нет данных" %}₽{% endif %}</span>
          <span><b>Среднесписоч. численность сотрудников</b>: {{comp["workerCountMean"]}}</span>
          <span><b>Спец. налоговой режим</b>: {{comp["taxMode"]}}</span>
          <span><b>Налоговая задолженность</b>: {{comp["taxDebt"]}}</span>
          <span><b>Количество открытых вакансий (hh.ru)</b>: {{comp["vacancyCount"]}}</span>
          <span><b>Налоговая нагрузка</b>: {{comp["taxBurden"]}}{% if comp["taxPayed"] != "Нет данных" %}%{% endif %}</span>
        </div>
        <div class="block" style="grid-area: finance;">
          <p class="header">Финансовая статистика:</p>
        {% if comp["taxBurden"] != "Нет данных" %}
          <div style="grid-area: pie;display:flex;flex-direction:column;align-items:center;jusitfy-content:center;"><canvas id="chart" height="150px"></canvas></div>
          <script>
            const ctx = document.getElementById('chart').getContext('2d');
            const myChart = new Chart(ctx, {
              type: 'bar',
              data: {
                labels: ['Выручка, руб', 'Расходы, руб', 'Сумма уплаченных налогов, руб'],
                datasets: [{
                  data: [{{comp["earnings"]}}, {{comp["expenses"]}}, {{comp["taxPayed"]}}],
                  backgroundColor: [
                    '#74E66B',
                    '#46009F',
                    '#EB3E26',
                  ],
                }]
              },
              options: {
                scales: {
                  y: {
                    beginAtZero: true
                  }
                },
                plugins: {
                  legend: {
                    display: false
                  }
                }
              }
            });
          </script>
        {% else %}
        <span><b>Нет данных</b></span>
        {% endif %}
        </div>
        <div class="block" >
          <p class="header">Данные о аккредитации компаний:</p>
          <div style="grid-area: pie;display:flex;flex-direction:column;align-items:center;jusitfy-content:center;">
          <div style="width: 50%;grid-area: pie;display:flex;flex-direction:column;align-items:center;jusitfy-content:center;"><canvas id="piechart"></canvas></div>
          <script>
            const ctx2 = document.getElementById('piechart').getContext('2d');
            const myChartPie = new Chart(ctx2, {
              type: 'doughnut',
              data: {
                labels: ['Аккредитованные компании', 'Неаккредитованные компании'],
                datasets: [{
                  data: [{{stats[2]}}, {{stats[0]}}-{{stats[2]}}],
                  backgroundColor: [
                    '#74E66B',
                    '#46009F',
                  ],
               }]
              },
              options: {
                radius: "80%",
              }
            });
          </script>
        </div>
        </div>
        <div class="block" style="grid-area: leader;">
          <p class="header">Сведения о руководителе:</p>
          <span><b>Руководитель</b>: {{comp["leaderName"]}}</span>
          <span><b>ИНН руководителя</b>: {{comp["leaderTID"]}}</span>
          <span><b>Контактный email</b>: {{comp["leaderEmail"]}}</span>
          <span><b>Контактный телефон</b>: {{comp["leaderPhone"]}}</span>
        </div>
      </div>
    </main>
    <footer style="grid-area: footer;"></footer>
    {% endblock %}
</body>
</html>
